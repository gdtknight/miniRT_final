# 인터랙티브 컨트롤

miniRT는 실시간 인터랙티브 컨트롤을 통해 장면을 동적으로 조작할 수 있습니다.

---

## 🎮 카메라 컨트롤

### 이동 (Translation)

| 키 | 동작 | 방향 |
|----|------|------|
| **W** | 전진 | 카메라가 보는 방향 |
| **X** | 후진 | 카메라 뒤쪽 |
| **A** | 좌측 이동 | 카메라 왼쪽 (스트레이프) |
| **D** | 우측 이동 | 카메라 오른쪽 (스트레이프) |
| **Q** | 상승 | 월드 Y축 위쪽 |
| **Z** | 하강 | 월드 Y축 아래쪽 |

**이동 거리**: 키당 1.0 단위

### 회전 (Rotation)

| 키 | 동작 | 설명 |
|----|------|------|
| **E** | 피치 회전 (위) | 카메라가 위를 바라봄 |
| **C** | 피치 회전 (아래) | 카메라가 아래를 바라봄 |

**회전 각도**: 키당 5도

### 리셋

| 키 | 동작 |
|----|------|
| **S** | 초기 위치로 리셋 |

---

## 🎯 객체 컨트롤

### 객체 선택

| 키 | 동작 |
|----|------|
| **[** | 이전 객체 선택 |
| **]** | 다음 객체 선택 |

**선택 순서**: 구체 → 평면 → 원기둥 (순환)

### 객체 이동

| 키 | 축 | 동작 |
|----|-----|------|
| **R** | X축 | 왼쪽으로 이동 |
| **T** | X축 | 오른쪽으로 이동 |
| **F** | Y축 | 아래로 이동 |
| **G** | Y축 | 위로 이동 |
| **V** | Z축 | 앞으로 이동 |
| **B** | Z축 | 뒤로 이동 |

**이동 거리**: 키당 1.0 단위

---

## 💡 광원 컨트롤

| 키 | 축 | 동작 |
|----|-----|------|
| **Insert** | X축 | 왼쪽으로 이동 |
| **Delete** | X축 | 오른쪽으로 이동 |
| **Home** | Y축 | 위로 이동 |
| **End** | Y축 | 아래로 이동 |
| **PageUp** | Z축 | 앞으로 이동 |
| **PageDown** | Z축 | 뒤로 이동 |

**이동 거리**: 키당 2.0 단위

---

## 🎨 UI 컨트롤

| 키 | 동작 |
|----|------|
| **H** | HUD 표시/숨김 토글 |
| **I** | 성능 정보 표시/숨김 토글 |
| **ESC** | 프로그램 종료 |
| **X (창 닫기)** | 프로그램 종료 |

---

## 📊 HUD 정보

HUD가 표시되면 다음 정보를 볼 수 있습니다:

### 장면 정보
- 총 객체 수 (구체/평면/원기둥)
- 카메라 위치 및 방향
- 광원 위치 및 밝기

### 선택된 객체
- 객체 타입
- 위치
- 크기 (지름/높이)
- 색상 (RGB)

### 성능 메트릭 (I 키)
- FPS (Frames Per Second)
- 렌더링 시간 (밀리초)
- BVH 통계 (노드 수, 깊이)

---

## 🔄 렌더링 동작

### 디바운싱 (Debouncing)

miniRT v2.1.0은 디바운싱 렌더링 시스템을 사용하여 부드러운 인터랙션을 제공합니다.

**작동 원리**:
- 키 입력 감지 후 150ms 동안 대기
- 150ms 내에 추가 입력이 없으면 렌더링 시작
- 입력이 계속되면 타이머를 리셋하여 불필요한 렌더링 방지

**사용자 경험 개선**:
- 입력 버퍼링 제거로 부드러운 조작감
- 불필요한 렌더링 90% 이상 감소
- 입력 지연 없는 즉각적인 반응

### 4-상태 렌더링 기계

렌더링 시스템은 4가지 상태로 동작합니다:

```
IDLE → ACTIVE → PREVIEW → FINAL
  ↑                          ↓
  └──────────────────────────┘
```

**1. IDLE (대기)**:
- 사용자 입력 없음
- 렌더링 없음

**2. ACTIVE (활성)**:
- 사용자 입력 감지
- 150ms 타이머 시작
- 추가 입력 시 타이머 리셋

**3. PREVIEW (프리뷰)**:
- 타이머 만료 (150ms 경과)
- 저품질 프리뷰 렌더링 시작
- 빠른 시각적 피드백 제공

**4. FINAL (최종)**:
- 프리뷰 완료 후 자동 전환
- 고품질 최종 렌더링
- 완료 후 IDLE 상태로 복귀

### 프리뷰 모드 (Preview Mode)

**개요**: 인터랙션 중 즉각적인 시각적 피드백을 제공하는 저품질 렌더링 모드입니다.

**특징**:
- **즉각적 반응**: 일반적으로 100ms 이하의 렌더링 시간
- **자동 전환**: 프리뷰 완료 후 고품질 최종 렌더로 자동 업그레이드
- **품질 조정**: 그림자 샘플 감소 등으로 렌더링 속도 향상

**사용자 이점**:
- 카메라나 객체를 움직일 때 즉시 결과 확인
- 입력 지연 없는 부드러운 인터랙션
- 최종 품질과 반응 속도의 균형

**작동 방식**:
```
사용자 입력 → 150ms 대기 → 프리뷰 렌더 (빠름) → 최종 렌더 (고품질)
```

### 렌더 상태 추적

**is_rendering 플래그**:
- 현재 렌더링 진행 여부 추적
- 실제 렌더링 중일 때만 취소 수행
- 불필요한 렌더 취소 방지로 효율성 향상

**스마트 취소 로직**:
- 렌더링 중에만 취소 (is_rendering = true)
- IDLE/PREVIEW 상태에서는 취소하지 않음
- 입력 응답성과 렌더 품질의 균형

---

## 🔗 관련 문서

- [빠른 시작 가이드](빠른-시작-가이드.md)
- [프로그램 개요](프로그램-개요.md)
- [레이 트레이싱 알고리즘](레이-트레이싱-알고리즘.md)

---

**Last Updated**: 2026-01  
**Version**: 2.1.0
