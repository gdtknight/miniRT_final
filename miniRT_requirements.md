# miniRT - 요구사항 및 유저 스토리

## 프로젝트 개요
**목표**: Ray Tracing 프로토콜을 사용하여 3D 이미지를 생성하는 프로그램 개발

---

## 필수 요구사항 (Mandatory Part)

### 프로그램 기본 정보
- **프로그램 이름**: `miniRT`
- **인자**: `.rt` 확장자를 가진 장면 파일
- **사용 가능 라이브러리**: 
  - miniLibX (필수)
  - libft (허용)
  - 수학 라이브러리 (`-lm` 플래그 필요)

### 허용된 함수
- `open`, `close`, `read`, `write`, `printf`, `malloc`, `free`, `perror`, `strerror`, `exit`
- 수학 라이브러리의 모든 함수
- MinilibX의 모든 함수
- `gettimeofday()`

### 핵심 기능 요구사항

#### 1. 지오메트릭 객체
- **필수 객체 3가지**:
  - 평면 (Plane)
  - 구 (Sphere)
  - 원기둥 (Cylinder)
- 모든 교차점과 객체 내부 처리 필수
- 객체 속성 조정 가능:
  - 구: 직경 조정
  - 원기둥: 너비 및 높이 조정

#### 2. 변환 (Transformation)
- 객체, 조명, 카메라에 대해:
  - 이동 (Translation) 구현
  - 회전 (Rotation) 구현
  - **예외**: 구와 조명은 회전 불가

#### 3. 조명 시스템
- **Ambient Lighting**: 주변광 (객체가 완전히 어둡지 않도록)
- **Diffuse Lighting**: 확산광
- 스팟 밝기 조절
- 하드 섀도우 (Hard Shadows)

#### 4. 윈도우 관리
- 창 전환, 최소화 등 유동적 처리
- **ESC 키**: 창 닫기 및 프로그램 종료
- **빨간 X 버튼**: 창 닫기 및 프로그램 종료
- MinilibX 이미지 사용 강력 권장

---

## 장면 파일 형식 (.rt)

### 파싱 규칙
- 각 요소는 하나 이상의 줄바꿈으로 구분 가능
- 각 정보는 하나 이상의 공백으로 구분 가능
- 요소는 파일 내 임의 순서로 배치 가능
- **대문자로 정의된 요소는 장면에서 한 번만 선언 가능**

### 요소 정의

#### A - Ambient Lighting (주변광)
```
A 0.2 255,255,255
```
- 식별자: `A`
- 주변광 비율 [0.0, 1.0]: `0.2`
- RGB 색상 [0-255]: `255,255,255`

#### C - Camera (카메라)
```
C -50.0,0,20 0,0,1 70
```
- 식별자: `C`
- x,y,z 좌표 (시점): `-50.0,0,20`
- 3D 정규화 방향 벡터 [-1,1]: `0,0,1`
- FOV (수평 시야각) [0,180]: `70`

#### L - Light (조명)
```
L -40.0,50.0,0.0 0.6 10,0,255
```
- 식별자: `L`
- x,y,z 좌표 (광원 위치): `-40.0,50.0,0.0`
- 밝기 비율 [0.0, 1.0]: `0.6`
- RGB 색상 [0-255] (필수 파트에서 미사용): `10,0,255`

#### sp - Sphere (구)
```
sp 0.0,0.0,20.6 12.6 10,0,255
```
- 식별자: `sp`
- x,y,z 좌표 (중심): `0.0,0.0,20.6`
- 직경: `12.6`
- RGB 색상 [0-255]: `10,0,255`

#### pl - Plane (평면)
```
pl 0.0,0.0,-10.0 0.0,1.0,0.0 0,0,225
```
- 식별자: `pl`
- x,y,z 좌표 (평면 위 한 점): `0.0,0.0,-10.0`
- 3D 정규화 법선 벡터 [-1,1]: `0.0,1.0,0.0`
- RGB 색상 [0-255]: `0,0,225`

#### cy - Cylinder (원기둥)
```
cy 50.0,0.0,20.6 0.0,0.0,1.0 14.2 21.42 10,0,255
```
- 식별자: `cy`
- x,y,z 좌표 (중심): `50.0,0.0,20.6`
- 3D 정규화 축 벡터 [-1,1]: `0.0,0.0,1.0`
- 직경: `14.2`
- 높이: `21.42`
- RGB 색상 [0-255]: `10,0,255`

### 예제 장면 파일
```
A  0.2                           255,255,255

C  -50,0,20        0,0,1         70
L  -40,0,30                      0.7       255,255,255

pl 0,0,0           0,1.0,0                 255,0,225
sp 0,0,20                        20        255,0,0
cy 50.0,0.0,20.6   0,0,1.0       14.2 21.42 10,0,255
```

### 에러 처리
- 파일에서 오류 발견 시:
  - 프로그램 정상 종료
  - `"Error\n"` 출력 후 명시적인 에러 메시지 표시

---

## 보너스 파트 (Bonus Part)

**평가 조건**: 필수 파트가 완벽할 때만 평가

### 보너스 목록
1. **Specular Reflection**: Phong 반사 모델 완성
2. **체커보드 패턴**: 색상 교란 효과
3. **컬러 및 다중 스팟 조명**
4. **추가 2차 객체**: 원뿔(cone), 쌍곡면(hyperboloid), 포물면(paraboloid) 중 하나
5. **범프 맵 텍스처** 처리

### 보너스 규칙
- 보너스를 위해 다른 함수 사용 및 기능 추가 가능
- 장면 파일 형식 변경 가능 (필요 시)
- 평가 시 정당화 필수

---

## 유저 스토리

### US-01: 기본 장면 렌더링
**As a** 사용자  
**I want to** `.rt` 파일을 인자로 프로그램을 실행하면  
**So that** 정의된 장면이 창에 렌더링되어 표시된다

**인수 조건**:
- 구, 평면, 원기둥이 올바르게 표시됨
- 카메라 시점과 FOV가 반영됨
- 파일 형식 오류 시 "Error\n" + 에러 메시지 출력

---

### US-02: 조명 효과 구현
**As a** 사용자  
**I want to** 장면에 주변광과 확산광이 적용되어  
**So that** 객체가 현실적인 명암을 가지며, 완전히 어둡지 않다

**인수 조건**:
- Ambient lighting이 모든 객체에 적용됨
- Diffuse lighting으로 광원 방향에 따른 밝기 변화
- 하드 섀도우가 정확히 표시됨

---

### US-03: 객체 변환 (이동/회전)
**As a** 개발자  
**I want to** 객체, 조명, 카메라에 이동 및 회전 변환을 적용할 수 있도록  
**So that** 다양한 장면 구성이 가능하다

**인수 조건**:
- 평면, 원기둥, 카메라의 회전이 정확함
- 구와 조명은 회전 불가 (구는 형태상, 조명은 점광원)
- 모든 객체의 위치 이동 가능

---

### US-04: 윈도우 제어
**As a** 사용자  
**I want to** ESC 키 또는 창의 X 버튼을 누르면  
**So that** 프로그램이 정상적으로 종료된다

**인수 조건**:
- ESC 키로 종료 가능
- 빨간 X 버튼 클릭으로 종료 가능
- 메모리 누수 없이 정리됨
- 창 전환/최소화 등이 유동적으로 처리됨

---

### US-05: 객체 교차점 계산
**As a** 렌더링 엔진  
**I want to** Ray와 객체(구, 평면, 원기둥)의 모든 교차점을 계산하여  
**So that** 정확한 이미지를 생성한다

**인수 조건**:
- 구와 Ray의 교차 계산 정확
- 평면과 Ray의 교차 계산 정확
- 원기둥(측면, 상하단)과 Ray의 교차 계산 정확
- 객체 내부 처리 정확

---

### US-06: 장면 파일 파싱
**As a** 프로그램  
**I want to** `.rt` 파일을 파싱하여 장면 정보를 읽어들이되  
**So that** 형식 오류 시 적절한 에러 메시지를 표시한다

**인수 조건**:
- A, C, L은 한 번만 선언 가능 (검증)
- 각 요소의 형식 검증 (범위, 타입)
- 요소 순서 무관하게 파싱
- 공백/줄바꿈 유연하게 처리
- 오류 발견 시 "Error\n" + 구체적 메시지

---

### US-07: 객체 속성 조정
**As a** 장면 설계자  
**I want to** 구의 직경, 원기둥의 너비/높이를 조정할 수 있도록  
**So that** 다양한 크기의 객체를 배치할 수 있다

**인수 조건**:
- 구의 직경 파라미터 반영
- 원기둥의 직경/높이 파라미터 반영
- 크기 변화가 렌더링에 정확히 반영됨

---

### US-08 (보너스): Phong 반사 모델
**As a** 사용자  
**I want to** Specular reflection이 적용되어  
**So that** 객체 표면이 광택 있게 표현된다

**인수 조건**:
- Specular highlight가 올바른 위치에 표시됨
- 반사 강도 조정 가능

---

### US-09 (보너스): 체커보드 패턴
**As a** 장면 설계자  
**I want to** 객체에 체커보드 패턴을 적용할 수 있도록  
**So that** 시각적으로 흥미로운 장면을 만들 수 있다

**인수 조건**:
- 평면 또는 구에 체커보드 적용 가능
- 패턴 크기 조정 가능

---

### US-10 (보너스): 다중 조명
**As a** 장면 설계자  
**I want to** 여러 개의 조명을 배치하고 색상을 지정할 수 있도록  
**So that** 복잡한 조명 효과를 구현할 수 있다

**인수 조건**:
- 다중 광원 지원
- 각 광원의 색상 독립적 설정
- 모든 광원의 영향이 누적됨

---

## Makefile 규칙
- `all`: 프로그램 빌드
- `clean`: 오브젝트 파일 삭제
- `fclean`: 실행 파일 포함 모두 삭제
- `re`: 재빌드
- `bonus`: 보너스 파트 빌드
- `dev`: 디버깅 플래그 추가해서 빌드

---

## 평가 준비 사항
- 다양한 테스트 장면 파일 준비 (정상 케이스, 에러 케이스)
- 각 기능을 테스트할 수 있는 최소한의 장면들
- 평가 중 요청될 수 있는 작은 수정 사항 대비 (코드 이해도 검증)

---

## 참고 이미지 시나리오
1. 구 + 스팟 조명 + 광택 (선택)
2. 원기둥 + 스팟 조명
3. 원뿔(선택) + 평면 + 스팟 조명
4. 모든 요소 + 2개 평면
5. 동일 장면 다른 카메라 각도
6. 섀도우 추가
7. 다중 스팟 조명
8. 다중 조명 + 체커보드 구(선택)
